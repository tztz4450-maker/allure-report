{"uid":"f1115a3c8418e506","name":"test_register","fullName":"tests.test_01_register#test_register","historyId":"dbf480063f8c6a444d61a4eced18c7dd","time":{"start":1766398964888,"stop":1766398965375,"duration":487},"status":"failed","statusMessage":"AssertionError: 接口返回的HTTP状态码 400 不在允许范围 [200]内","statusTrace":"raw_client = <utils.api_client.ApiClient object at 0x000001A8B309D450>\n\n    @pytest.mark.smoke\n    @allure.feature(\"注册 / 登录模块\")\n    @allure.story(\"注册 / 登录接口\")\n    def test_register(raw_client):\n        cases = load_yaml(\"data/register.yaml\")\n    \n        for case in cases:\n            with allure.step(case.get(\"desc\", \"注册接口\")):\n    \n                resp = raw_client.request(\n                    method=\"POST\",\n                    url=\"/auth/register?force_no_encrypt=567f9c9a-28cf-4096-b540-e428f40a1e74-jh82\",\n                    params=case[\"request\"].get(\"params\"),\n                    json_body=case[\"request\"]\n                )\n                # ✅ 公司级唯一断言入口\n>               biz = assert_api_response(resp, case[\"expected\"])\n\ntests\\test_01_register.py:22: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nresp = ApiResponse(response=<Response [400]>, raw_text='{\"code\":40091,\"message\":\"验证码校验失败\"}', json_data={'code': 40091, 'message': '验证码校验失败'}, biz_json={'code': 40091, 'message': '验证码校验失败'})\nexpected = {'allow_biz_codes': [200], 'allow_http_codes': [200], 'token_prefix': 'Bearer'}\n\n    def assert_api_response(resp, expected):\n        \"\"\"\n        通用接口断言（完全适配 ApiResponse）\n        \"\"\"\n    \n        # ======================\n        # 0️⃣ 响应展示（先做，避免断言失败看不到）\n        # ======================\n        body = _safe_response_body(resp)\n        logging.info(f\"[HTTP] status={getattr(resp, 'status_code', None)}\")\n        # logging.info(f\"[RESP] body={body}\")\n    \n        _attach(\"response_body\", body)\n    \n        # ======================\n        # ① HTTP 状态码校验\n        # ======================\n        allow_http = expected.get(\"allow_http_codes\", [200])\n        if allow_http:\n>           assert resp.status_code in allow_http, \\\n                f\"接口返回的HTTP状态码 {resp.status_code} 不在允许范围 {allow_http}内\"\nE           AssertionError: 接口返回的HTTP状态码 400 不在允许范围 [200]内\n\nutils\\assert_util.py:70: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"raw_client","time":{"start":1766398964888,"stop":1766398964888,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentsCount":0,"shouldDisplayMessage":false,"stepsCount":0,"attachmentStep":false},{"name":"pytestconfig","time":{"start":1766398964888,"stop":1766398964888,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentsCount":0,"shouldDisplayMessage":false,"stepsCount":0,"attachmentStep":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: 接口返回的HTTP状态码 400 不在允许范围 [200]内","statusTrace":"raw_client = <utils.api_client.ApiClient object at 0x000001A8B309D450>\n\n    @pytest.mark.smoke\n    @allure.feature(\"注册 / 登录模块\")\n    @allure.story(\"注册 / 登录接口\")\n    def test_register(raw_client):\n        cases = load_yaml(\"data/register.yaml\")\n    \n        for case in cases:\n            with allure.step(case.get(\"desc\", \"注册接口\")):\n    \n                resp = raw_client.request(\n                    method=\"POST\",\n                    url=\"/auth/register?force_no_encrypt=567f9c9a-28cf-4096-b540-e428f40a1e74-jh82\",\n                    params=case[\"request\"].get(\"params\"),\n                    json_body=case[\"request\"]\n                )\n                # ✅ 公司级唯一断言入口\n>               biz = assert_api_response(resp, case[\"expected\"])\n\ntests\\test_01_register.py:22: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nresp = ApiResponse(response=<Response [400]>, raw_text='{\"code\":40091,\"message\":\"验证码校验失败\"}', json_data={'code': 40091, 'message': '验证码校验失败'}, biz_json={'code': 40091, 'message': '验证码校验失败'})\nexpected = {'allow_biz_codes': [200], 'allow_http_codes': [200], 'token_prefix': 'Bearer'}\n\n    def assert_api_response(resp, expected):\n        \"\"\"\n        通用接口断言（完全适配 ApiResponse）\n        \"\"\"\n    \n        # ======================\n        # 0️⃣ 响应展示（先做，避免断言失败看不到）\n        # ======================\n        body = _safe_response_body(resp)\n        logging.info(f\"[HTTP] status={getattr(resp, 'status_code', None)}\")\n        # logging.info(f\"[RESP] body={body}\")\n    \n        _attach(\"response_body\", body)\n    \n        # ======================\n        # ① HTTP 状态码校验\n        # ======================\n        allow_http = expected.get(\"allow_http_codes\", [200])\n        if allow_http:\n>           assert resp.status_code in allow_http, \\\n                f\"接口返回的HTTP状态码 {resp.status_code} 不在允许范围 {allow_http}内\"\nE           AssertionError: 接口返回的HTTP状态码 400 不在允许范围 [200]内\n\nutils\\assert_util.py:70: AssertionError","steps":[{"name":"正常注册","time":{"start":1766398964888,"stop":1766398965375,"duration":487},"status":"failed","statusMessage":"AssertionError: 接口返回的HTTP状态码 400 不在允许范围 [200]内\n","statusTrace":"  File \"D:\\PycharmProjects\\23pg-api-test\\tests\\test_01_register.py\", line 22, in test_register\n    biz = assert_api_response(resp, case[\"expected\"])\n  File \"D:\\PycharmProjects\\23pg-api-test\\utils\\assert_util.py\", line 70, in assert_api_response\n    assert resp.status_code in allow_http, \\\n","steps":[],"attachments":[{"uid":"d180853eba979d55","name":"response_body","source":"d180853eba979d55.json","type":"application/json","size":57}],"parameters":[],"hasContent":true,"attachmentsCount":1,"shouldDisplayMessage":true,"stepsCount":0,"attachmentStep":false}],"attachments":[{"uid":"7a37707422e5bd0e","name":"log","source":"7a37707422e5bd0e.txt","type":"text/plain","size":1186}],"parameters":[],"hasContent":true,"attachmentsCount":2,"shouldDisplayMessage":true,"stepsCount":1,"attachmentStep":false},"afterStages":[],"labels":[{"name":"story","value":"注册 / 登录接口"},{"name":"feature","value":"注册 / 登录模块"},{"name":"tag","value":"smoke"},{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_01_register"},{"name":"host","value":"DESKTOP-1OGQ5RE"},{"name":"thread","value":"5468-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_01_register"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[]}],"tags":["smoke"]},"source":"f1115a3c8418e506.json","parameterValues":[]}
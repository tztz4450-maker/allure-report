{"uid":"995cad407f0e74b7","name":"test_register","fullName":"tests.test_01_register#test_register","historyId":"dbf480063f8c6a444d61a4eced18c7dd","time":{"start":1766637006039,"stop":1766637006495,"duration":456},"status":"failed","statusMessage":"AssertionError: 接口返回的业务code 40055 不在允许范围 [200, 40091, 40002] 内，msg=您输入的密码错误次数过多,请于00:29:57小时后再尝试登陆","statusTrace":"anon_client = <utils.api_client.ApiClient object at 0x000002615A94F070>\n\n    @allure.feature(\"登录/注册\")\n    def test_register(anon_client):\n        cases = load_yaml(\"data/register.yaml\")\n    \n        for case in cases:\n            req = case[\"request\"].copy()\n            req[\"username\"] = f\"tz8001\"\n    \n            resp = anon_client.request(\n                method=\"POST\",\n                url=\"/auth/register\",\n                params=req.get(\"params\"),\n                json_body=req\n            )\n    \n>           assert_api_response(resp, case[\"expected\"])\n\ntests\\test_01_register.py:51: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nresp = ApiResponse(response=<Response [400]>, raw_text='{\"code\":40055,\"message\":\"您输入的密码错误次数过多,请于00:29:57小时后再尝试登陆\",\"data\":{\"re...:57'}}, biz_json={'code': 40055, 'message': '您输入的密码错误次数过多,请于00:29:57小时后再尝试登陆', 'data': {'remaining_time': '00:29:57'}})\nexpected = {'allow_biz_codes': [200, 40091, 40002], 'allow_http_codes': [200, 400], 'token_prefix': 'Bearer'}\n\n    def assert_api_response(resp, expected):\n        \"\"\"\n        通用接口断言（Allure / TG / 日志 友好版）\n    \n        规则：\n        - 业务 code 优先\n        - HTTP 状态码只兜底\n        - 失败只 attach 一次 response_body\n        \"\"\"\n    \n        body = _safe_response_body(resp)\n        biz_json = resp.biz_json or {}\n        http_status = getattr(resp, \"status_code\", None)\n    \n        logging.info(\"[HTTP] status=%s\", http_status)\n    \n        # =====================================================\n        # 1️⃣ 业务 code 校验（核心）\n        # =====================================================\n        allow_biz = expected.get(\"allow_biz_codes\")\n    \n        if isinstance(allow_biz, list) and allow_biz:\n            biz_code = _extract_biz_code(biz_json)\n    \n            if isinstance(biz_code, str) and biz_code.isdigit():\n                biz_code = int(biz_code)\n    \n            biz_msg = _extract_biz_msg(biz_json)\n            msg_suffix = f\"，msg={biz_msg}\" if biz_msg else \"\"\n    \n            logging.info(\n                \"[业务断言] 实际 code=%s | 允许=%s\",\n                biz_code,\n                allow_biz\n            )\n    \n            if biz_code is None:\n                _attach_response(body)\n                raise AssertionError(\n                    f\"接口未返回业务code，HTTP={http_status}{msg_suffix}\"\n                )\n    \n            if biz_code not in allow_biz:\n                _attach_response(body)\n>               raise AssertionError(\n                    f\"接口返回的业务code {biz_code} \"\n                    f\"不在允许范围 {allow_biz} 内\"\n                    f\"{msg_suffix}\"\n                )\nE               AssertionError: 接口返回的业务code 40055 不在允许范围 [200, 40091, 40002] 内，msg=您输入的密码错误次数过多,请于00:29:57小时后再尝试登陆\n\nutils\\assert_util.py:260: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":1,"retriesStatusChange":false,"beforeStages":[{"name":"pytestconfig","time":{"start":1766637002109,"stop":1766637002109,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"attachmentStep":false},{"name":"raw_client","time":{"start":1766637002109,"stop":1766637002111,"duration":2},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"attachmentStep":false},{"name":"auth_client","time":{"start":1766637002111,"stop":1766637003356,"duration":1245},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"attachmentStep":false},{"name":"anon_client","time":{"start":1766637006039,"stop":1766637006039,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"attachmentStep":false},{"name":"auth_guard","time":{"start":1766637006039,"stop":1766637006039,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"attachmentStep":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: 接口返回的业务code 40055 不在允许范围 [200, 40091, 40002] 内，msg=您输入的密码错误次数过多,请于00:29:57小时后再尝试登陆","statusTrace":"anon_client = <utils.api_client.ApiClient object at 0x000002615A94F070>\n\n    @allure.feature(\"登录/注册\")\n    def test_register(anon_client):\n        cases = load_yaml(\"data/register.yaml\")\n    \n        for case in cases:\n            req = case[\"request\"].copy()\n            req[\"username\"] = f\"tz8001\"\n    \n            resp = anon_client.request(\n                method=\"POST\",\n                url=\"/auth/register\",\n                params=req.get(\"params\"),\n                json_body=req\n            )\n    \n>           assert_api_response(resp, case[\"expected\"])\n\ntests\\test_01_register.py:51: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nresp = ApiResponse(response=<Response [400]>, raw_text='{\"code\":40055,\"message\":\"您输入的密码错误次数过多,请于00:29:57小时后再尝试登陆\",\"data\":{\"re...:57'}}, biz_json={'code': 40055, 'message': '您输入的密码错误次数过多,请于00:29:57小时后再尝试登陆', 'data': {'remaining_time': '00:29:57'}})\nexpected = {'allow_biz_codes': [200, 40091, 40002], 'allow_http_codes': [200, 400], 'token_prefix': 'Bearer'}\n\n    def assert_api_response(resp, expected):\n        \"\"\"\n        通用接口断言（Allure / TG / 日志 友好版）\n    \n        规则：\n        - 业务 code 优先\n        - HTTP 状态码只兜底\n        - 失败只 attach 一次 response_body\n        \"\"\"\n    \n        body = _safe_response_body(resp)\n        biz_json = resp.biz_json or {}\n        http_status = getattr(resp, \"status_code\", None)\n    \n        logging.info(\"[HTTP] status=%s\", http_status)\n    \n        # =====================================================\n        # 1️⃣ 业务 code 校验（核心）\n        # =====================================================\n        allow_biz = expected.get(\"allow_biz_codes\")\n    \n        if isinstance(allow_biz, list) and allow_biz:\n            biz_code = _extract_biz_code(biz_json)\n    \n            if isinstance(biz_code, str) and biz_code.isdigit():\n                biz_code = int(biz_code)\n    \n            biz_msg = _extract_biz_msg(biz_json)\n            msg_suffix = f\"，msg={biz_msg}\" if biz_msg else \"\"\n    \n            logging.info(\n                \"[业务断言] 实际 code=%s | 允许=%s\",\n                biz_code,\n                allow_biz\n            )\n    \n            if biz_code is None:\n                _attach_response(body)\n                raise AssertionError(\n                    f\"接口未返回业务code，HTTP={http_status}{msg_suffix}\"\n                )\n    \n            if biz_code not in allow_biz:\n                _attach_response(body)\n>               raise AssertionError(\n                    f\"接口返回的业务code {biz_code} \"\n                    f\"不在允许范围 {allow_biz} 内\"\n                    f\"{msg_suffix}\"\n                )\nE               AssertionError: 接口返回的业务code 40055 不在允许范围 [200, 40091, 40002] 内，msg=您输入的密码错误次数过多,请于00:29:57小时后再尝试登陆\n\nutils\\assert_util.py:260: AssertionError","steps":[],"attachments":[{"uid":"fcb3f8a6c209acbe","name":"response_body","source":"fcb3f8a6c209acbe.json","type":"application/json","size":161},{"uid":"70fa6ed051a20d34","name":"log","source":"70fa6ed051a20d34.txt","type":"text/plain","size":6407}],"parameters":[],"hasContent":true,"shouldDisplayMessage":true,"attachmentsCount":2,"stepsCount":0,"attachmentStep":false},"afterStages":[],"labels":[{"name":"feature","value":"登录/注册"},{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_01_register"},{"name":"host","value":"DESKTOP-1OGQ5RE"},{"name":"thread","value":"18180-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_01_register"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[{"uid":"c64a9bb6c8b61f5b","status":"failed","statusDetails":"AssertionError: 接口返回的业务code 40055 不在允许范围 [200, 40091, 40002] 内，msg=您输入的密码错误次数过多,请于00:29:59小时后再尝试登陆","time":{"start":1766637003356,"stop":1766637003943,"duration":587}}],"categories":[{"name":"Product defects","matchedStatuses":[]}],"tags":[]},"source":"995cad407f0e74b7.json","parameterValues":[]}